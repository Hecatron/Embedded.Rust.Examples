
# Common to all profiles
[env]
# Show debugging info on error of build
RUST_BACKTRACE = 1
# Use the custom esp toolchain
RUSTUP_TOOLCHAIN="esp"

# Default Profile
[env.development]
BUILD_OUT_DIR = "./${CARGO_MAKE_CRATE_CUSTOM_TRIPLE_TARGET_DIRECTORY}/debug"
BUILD_ELF_FILE = "${BUILD_OUT_DIR}/${CARGO_MAKE_PROJECT_NAME}"
BUILD_BIN_FILE = "${BUILD_ELF_FILE}.bin"

# Production / Release Profile
[env.production]
BUILD_OUT_DIR = "./${CARGO_MAKE_CRATE_CUSTOM_TRIPLE_TARGET_DIRECTORY}/release"
BUILD_ELF_FILE = "${BUILD_OUT_DIR}/${CARGO_MAKE_PROJECT_NAME}"
BUILD_BIN_FILE = "${BUILD_ELF_FILE}.bin"


# TODO production profile
[tasks.build]
description = "build the source"
command = "cargo"
args = ["build", "${@}"]
category = "ESP32"

# TODO move release flag to env var
[tasks.build-prod]
description = "build the source in Production mode"
command = "cargo"
args = ["build", "--release", "${@}"]
category = "ESP32"

[tasks.format]
description = "reformat the rust code using rustfmt"
install_crate = "rustfmt"
command = "cargo"
args = ["fmt", "--", "--emit=files"]

# Todo
# waiting for some form of this to go through
# https://github.com/sagiegurari/cargo-make/pull/603

#[tasks.list]
#description = "List all of the associated build / flash tasks - ESP32"
#command = "D:/SourceCode/Forks/cargo-make/target/debug/makers.exe"
#args = ["--list-category-steps", "ESP32"]
