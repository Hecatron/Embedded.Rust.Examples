# Todo rename this file to config.toml
# after moving from cargo xbuild to cargo build using build-std

[build]
target = "xtensa-esp32-none-elf"

# Re-enable when we switch from xbuild to build
#[unstable]
#build-std = ["core", "alloc"]

[target.xtensa-esp32-none-elf]
runner = "xtensa-esp32-elf-gdb -q -x openocd.gdb"
rustflags = [
  "-C", "link-arg=-Wl,-Tlink.x",
  "-C", "link-arg=-nostartfiles",


  "-C", "target-cpu=esp32",
  "-C", "link-arg=-nostdlib",
  "-C", "link-arg=-Wl,--gc-sections",
  "-C", "link-arg=-Wl,-static",
  "-C", "link-arg=-Wl,--start-group",
  "-C", "link-arg=-Wl,--undefined=uxTopUsedPriority",

  #"-C", "link-arg=-Tbin/ld/esp32_out.ld",
  #"-C", "link-arg=-Tbin/ld/esp32.project.ld",
  "-C", "link-arg=-Lbin/lib",

# TODO auto generate
  "-C", "link-arg=-lapp_trace",
  "-C", "link-arg=-lapp_update",
  "-C", "link-arg=-lasio",
  "-C", "link-arg=-lbootloader_support",
  "-C", "link-arg=-lcbor",
  "-C", "link-arg=-lcoap",
  "-C", "link-arg=-lconsole",
  "-C", "link-arg=-lcxx",
  "-C", "link-arg=-ldriver",
  "-C", "link-arg=-lefuse",
  "-C", "link-arg=-lesp_adc_cal",
  "-C", "link-arg=-lesp_common",
  "-C", "link-arg=-lesp_eth",
  "-C", "link-arg=-lesp_event",
  "-C", "link-arg=-lesp_gdbstub",
  "-C", "link-arg=-lesp_hid",
  "-C", "link-arg=-lesp_http_client",
  "-C", "link-arg=-lesp_http_server",
  "-C", "link-arg=-lesp_https_ota",
  "-C", "link-arg=-lesp_ipc",
  "-C", "link-arg=-lesp_local_ctrl",
  "-C", "link-arg=-lesp_netif",
  "-C", "link-arg=-lesp_ringbuf",
  "-C", "link-arg=-lesp_serial_slave_link",
  "-C", "link-arg=-lesp_system",
  "-C", "link-arg=-lesp_timer",
  "-C", "link-arg=-lesp_websocket_client",
  "-C", "link-arg=-lesp_wifi",
  "-C", "link-arg=-lesp32",
  "-C", "link-arg=-lespcoredump",
  "-C", "link-arg=-lesp-tls",
  "-C", "link-arg=-lexpat",
  "-C", "link-arg=-lfatfs",
  "-C", "link-arg=-lfreemodbus",
  #"-C", "link-arg=-lfreertos",
  "-C", "link-arg=-lheap",
  "-C", "link-arg=-ljsmn",
  "-C", "link-arg=-ljson",
  "-C", "link-arg=-llibsodium",
  "-C", "link-arg=-llog",
  "-C", "link-arg=-llwip",
  #"-C", "link-arg=-lmain",
  "-C", "link-arg=-lmbedcrypto",
  "-C", "link-arg=-lmbedtls",
  "-C", "link-arg=-lmbedx509",
  "-C", "link-arg=-lmdns",
  "-C", "link-arg=-lmicro-ecc",
  "-C", "link-arg=-lmqtt",
  "-C", "link-arg=-lnewlib",
  "-C", "link-arg=-lnghttp",
  "-C", "link-arg=-lnvs_flash",
  "-C", "link-arg=-lopenssl",
  "-C", "link-arg=-lperfmon",
  "-C", "link-arg=-lprotobuf-c",
  "-C", "link-arg=-lprotocomm",
  "-C", "link-arg=-lpthread",
  "-C", "link-arg=-lsdmmc",
  "-C", "link-arg=-lsoc",
  "-C", "link-arg=-lsoc_esp32",
  "-C", "link-arg=-lspi_flash",
  "-C", "link-arg=-lspiffs",
  "-C", "link-arg=-ltcp_transport",
  "-C", "link-arg=-ltcpip_adapter",
  "-C", "link-arg=-lulp",
  "-C", "link-arg=-lunity",
  "-C", "link-arg=-lvfs",
  "-C", "link-arg=-lwear_levelling",
  "-C", "link-arg=-lwifi_provisioning",
  "-C", "link-arg=-lwpa_supplicant",
  "-C", "link-arg=-lxtensa",

  "-C", "link-arg=-lgcc",
  "-C", "link-arg=-lstdc++",
  "-C", "link-arg=-lgcov",
  "-C", "link-arg=-Wl,--end-group",
  "-C", "link-arg=-Wl,-EL",


]
